From f47be5c3a47bce33b91d9ea3b1144e6f9c584199 Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Sun, 2 Mar 2025 22:14:34 +1100
Subject: [PATCH 7/7] export symbols needed by grpc

---
 src/google/protobuf/io/coded_stream.cc | 2 +-
 upb/mem/alloc.h                        | 2 +-
 upb/mem/internal/arena.h               | 2 ++
 3 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/google/protobuf/io/coded_stream.cc b/src/google/protobuf/io/coded_stream.cc
index f8d7b71a1..974df3571 100644
--- a/src/google/protobuf/io/coded_stream.cc
+++ b/src/google/protobuf/io/coded_stream.cc
@@ -1016,7 +1016,7 @@ uint8_t* EpsCopyOutputStream::WriteCordOutline(const absl::Cord& c, uint8_t* ptr
   return WriteCord(c, ptr);
 }
 
-std::atomic<bool> CodedOutputStream::default_serialization_deterministic_{
+PROTOBUF_EXPORT std::atomic<bool> CodedOutputStream::default_serialization_deterministic_{
     false};
 
 CodedOutputStream::~CodedOutputStream() { Trim(); }
diff --git a/upb/mem/alloc.h b/upb/mem/alloc.h
index 441731d2d..8f46e9afd 100644
--- a/upb/mem/alloc.h
+++ b/upb/mem/alloc.h
@@ -52,7 +52,7 @@ UPB_INLINE void upb_free(upb_alloc* alloc, void* ptr) {
 
 // The global allocator used by upb. Uses the standard malloc()/free().
 
-extern upb_alloc upb_alloc_global;
+UPB_API extern upb_alloc upb_alloc_global;
 
 /* Functions that hard-code the global malloc.
  *
diff --git a/upb/mem/internal/arena.h b/upb/mem/internal/arena.h
index 9a6469edc..796763a3f 100644
--- a/upb/mem/internal/arena.h
+++ b/upb/mem/internal/arena.h
@@ -49,6 +49,8 @@ UPB_INLINE size_t UPB_PRIVATE(_upb_ArenaHas)(const struct upb_Arena* a) {
   return (size_t)(a->UPB_ONLYBITS(end) - a->UPB_ONLYBITS(ptr));
 }
 
+UPB_API void* UPB_PRIVATE(_upb_Arena_SlowMalloc)(struct upb_Arena * a, size_t size);
+
 UPB_API_INLINE void* upb_Arena_Malloc(struct upb_Arena* a, size_t size) {
   void* UPB_PRIVATE(_upb_Arena_SlowMalloc)(struct upb_Arena * a, size_t size);
 
