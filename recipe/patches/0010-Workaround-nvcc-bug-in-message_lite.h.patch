From 92579b02f5a25e1ae49d635281d3e38bc6d7928d Mon Sep 17 00:00:00 2001
From: Isuru Fernando <isuruf@gmail.com>
Date: Mon, 13 Oct 2025 16:10:25 -0500
Subject: [PATCH 10/10] Workaround nvcc bug in message_lite.h

See https://github.com/protocolbuffers/protobuf/issues/21542

Patch by Samuel Benzaquen (sbenzaquen)
---
 src/google/protobuf/message_lite.h | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/src/google/protobuf/message_lite.h b/src/google/protobuf/message_lite.h
index a5d51a5e0..b42577d67 100644
--- a/src/google/protobuf/message_lite.h
+++ b/src/google/protobuf/message_lite.h
@@ -281,11 +281,18 @@ struct MessageTraitsImpl {
 template <typename T>
 using MessageTraits = decltype(MessageTraitsImpl::value<T>);
 
+#ifdef __CUDACC__
+struct EnumTraitsImpl {
+  template <typename T>
+  static std::enable_if_t<sizeof(T) != 0> value;
+};
+#else
 struct EnumTraitsImpl {
   struct Undefined;
   template <typename T>
   static Undefined value;
 };
+#endif
 template <typename T>
 using EnumTraits = decltype(EnumTraitsImpl::value<T>);
 
